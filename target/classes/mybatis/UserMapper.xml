<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.webill.core.service.mapper.UserMapper">

	<!-- 通用查询结果列-->
	<sql id="Base_Column_List">
		id, open_id AS openId, bank_mobile_no AS bankMobileNo, mobile_no AS mobileNo, password, id_no AS idNo, bank_card_no AS bankCardNo, real_name AS realName, email, com_id AS comId, is_staff AS isStaff, is_verified AS isVerified, standard_times AS standardTimes, advanced_times AS advancedTimes, memeber_level AS memeberLevel, member_start_date AS memberStartDate, member_end_date AS memberEndDate, t_status AS tStatus, updated_time AS updatedTime, created_time AS createdTime
	</sql>
	<sql id="U_Base_Column_List">
		u.id, u.open_id AS openId, u.bank_mobile_no AS bankMobileNo, u.mobile_no AS mobileNo, u.password, u.id_no AS idNo, u.bank_card_no AS bankCardNo, u.real_name AS realName, u.email, u.com_id AS comId, u.is_staff AS isStaff, u.is_verified AS isVerified, u.standard_times AS standardTimes, u.advanced_times AS advancedTimes, u.memeber_level AS memeberLevel, u.member_start_date AS memberStartDate, u.member_end_date AS memberEndDate, u.t_status AS tStatus, u.updated_time AS updatedTime, u.created_time AS createdTime
	</sql>
	<select id="getList" resultType="com.webill.core.model.User">
		SELECT
			<include refid="U_Base_Column_List"></include>,
			u2.weixin_nick AS recommendName
		FROM
			`user` u
		LEFT JOIN `user` u2 ON u.recommend_id = u2.id
		WHERE
			1 = 1
			AND u.is_staff = 0
		<if test="weixinNick!=null and weixinNick!=''">
			AND u.weixin_nick LIKE concat(concat('%',#{weixinNick}),'%')
		</if>
		<if test="realName!=null and realName!=''">
			AND u.real_name LIKE concat(concat('%',#{realName}),'%')
		</if>
		<if test="timeFrom!=null and timeFrom!='' ">
			AND u.created_time &gt;= str_to_date('${timeFrom} 00:00:00','%Y-%m-%d %H:%i:%s')
		</if>
		<if test="timeTo!=null and timeTo!='' ">
			AND u.created_time &lt;= str_to_date('${timeTo} 23:59:59','%Y-%m-%d %H:%i:%s')
		</if>		
		<if test="licenseNo!=null and licenseNo!=''">
			AND u.id IN (SELECT cur.user_id from car_user_rel cur WHERE cur.license_no LIKE concat(concat('%',#{licenseNo}),'%'))
		</if>
	</select>
	
</mapper>